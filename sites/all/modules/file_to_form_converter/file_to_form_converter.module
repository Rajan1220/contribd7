<?php 
/**
 * Implements hook_block_info().
 */
function file_to_form_converter_block_info() {
  $blocks = array();
  $blocks['file_to_block'] = array(
    'info' => t('File To Form Converter'),
	  //'cache' => DRUPAL_NO_CACHE,
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function file_to_form_converter_block_view($delta = '') {
  $block = array();
  switch ($delta) {
    case 'file_to_block':
      $block['subject'] = t('File To Form Converter');
      $block['content'] = drupal_get_form('file_to_form_converter_form');
      break;
  }
  return $block;
}

/**
 * Implements file_to_form_converter_form().
 */
function file_to_form_converter_form($form, &$form_state) {
  $form = array();
  $form['file_to_convert'] = array(
    '#type' => 'file',
    '#title' => t('Upload File'),
    '#description' => t('Upload a file, allowed extension: csv'),
    "#upload_validators"  => array("file_validate_extensions" => array("csv")),
  );
  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Converet',
    );
  return $form;
}

/*function file_to_form_converter_form_validate($form, &$form_state) {
  $validator = array(
    'file_validate_is_image',
    'file_validate_extensions' => array('csv'),
  );
  // check if folder exists
  $dest = 'public://';
  if(!file_prepare_directory($dest)) {
    drupal_mkdir($dest);
  }
}*/

function file_to_form_converter_form_submit($form, &$form_state) {
  //$file = $form_state['storage']['file'];
    // We are done with the file, remove it from storage.
  //unset($form_state['storage']['file']);
    // Make the storage of the file permanent
  //$file->status = FILE_STATUS_PERMANENT;
    // Save file status.
  $validator = array(
    'file_validate_is_image',
    'file_validate_extensions' => array('csv'),
  );
  $dest = 'public://';
  if(!file_prepare_directory($dest)) {
    drupal_mkdir($dest);
  }
  //$file = file_save_upload('file_to_convert', $validator, $dest, FILE_EXISTS_RENAME);
  //file_save($file);
    // Set a response to the user.
  drupal_set_message(t('File uploaded sucessfully !'));
}

/**
 * Implements hook_preprocess_block().
 */
/*function file_to_form_converter_preprocess_block(&$variables) {
  if ($variables['block']->bid === 'target_block_id') {
  
  } 
  else if ($variables['block']->bid === 'other_target_block_id') {
  
  }
}*/
?>